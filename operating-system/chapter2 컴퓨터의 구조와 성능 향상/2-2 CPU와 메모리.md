# 2-2. CPU와 메모리

## 1. CPU의 구성과 동작

### 1.1 CPU의 기본 구성

- 산술논리 연산장치, 제어장치, 레지스터로 구성

- 산술논리 연산장치

  - CPU에서 데이터 연산
  - 산술 연산, 논리 연산 수행

- 제어장치

  - CPU에서 작업을 지시하는 부분

- 레지스터
  - CPU 내에 데이터를 임시로 보관하는 곳

### 1.2 CPU의 명령어 처리 과정

- 레지스터: CPU가 연산을 할 때 필요한 데이터를 CPU로 가져와 임시 보관

```c
int D2=2, D3=3, sum;
sum=D2+D3;
```

- 어셈블리어에서는 LOAD, ADD, MOVE의 과정이 진행된다.

1. CPU가 필요한 데이터를 메모리에서 가져와 레지스터에 저장
2. 산술논리 연산장치를 이용하여 연산
3. 그 결과를 다시 레지스터에 저장했다가 메모리로 옮김

### 1.3 레지스터의 종류

> 임시 저장의 개념

- **데이터 레지스터(DR)**

  - 메모리에서 가져온 데이터를 **임시로 보관**
  - 일반 레지스터, 범용 레지스터

- **주소 레지스터(AR)**
  - 데이터 또는 명령어가 저장된 **메모리의 주소** 저장
- 특수 레지스터(사용자 불가시 레지스터)

  - **프로그램 카운터(PC)**
    - **다음에 실행할 명령어의 주소**를 기억하고 있다가 제어장치에 알려줌
    - 명령어 포인터
  - **명령어 레지스터(IR)**
    - 현재 실행 중인 명령어를 저장
    - 제어장치는 **명령어 레지스터에 있는 명령을 해석**한 후 외부 장치에 적절한 제어신호를 보냄
  - **메모리 주소 레지스터(MAR)**
    - 메모리에서 데이터를 가져오거나, 메모리로 데이터를 보낼 때 **주소를 지정하기 위해 사용**
    - 메모리 관리자가 이 곳의 메모리 주소를 인식하여 해당 메모리 위치의 데이터를 가져오거나 해당 메모리 위치에 데이터를 저장
  - **메모리 버퍼 레지스터(MBR)**
    - 메모리에서 가져온 데이터나 메모리로 **옮겨 갈 데이터를 임시 저장**
    - 항상 **메모리 주소 레지스터와 함께 동작**

- **프로그램 상태 레지스터**
  - 산술논리 연산장치와 연결
  - 연산 결과가 양수인지, 음수인지, 0이 아닌지 또는 자리올림의 유무 등을 저장

### 1.4 버스의 종류

> CPU와 메모리, 주변장치 간에 **데이터를 주고받을 때 사용**

![시스템버스.png](/operating-system/images/시스템버스.png)

- **제어 버스**
  - 다음에 어떤 작업을 할지 지시하는 제어 신호가 오고감
  - 읽기 신호, 쓰기 신호
  - 메모리, 주변장치, CPU의 제어장치에 **양방향**으로 오고감
  - 주변장치: 하드디스크에 저장 명령을 내리거나 사운드카드 소리에 내라는 명령을 내릴 때
- **주소 버스**

  - 메모리의 데이터를 읽거나 쓸 때 어느 위치에서 작업할 것인지 알려주는 위치 정보(주소)가 오감
  - **메모리 주소 레지스터**와 연결됨
  - CPU에서 메모리나 주변장치로 나가는 주소 정보는 있지만, **주소 버스를 통해** CPU로 **전달되는** 정보는 없음

- **데이터 버스**

  - **메모리 버퍼 레지스터**와 연결
  - **제어 버스**가 다음에 어떤 작업을 할지 신호를 보내고 주소 버스가 위치 정보를 전달하면 데이터가 **데이터 버스**에 실려 목적지까지 이동함

- 버스의 대역폭
  - 한 번에 전달할 수 있는 데이터의 최대 크기(워드)
  - CPU가 한 번에 처리할 수 있는 데이터의 크기
  - ex. 32bit → 레지스터의 크기가 32bit, 버스 대역폭이 32bit, 한번에 최대 32bit 처리, 1워드

## 2. 메모리의 종류와 부팅

- 메모리에는 실행에 필요한 프로그램과 데이터 존재
  - CPU와 협업하여 작업이 이루어짐
- 메모리를 이루는 소자 하나의 크기는 1bit
  - 0과 1이 저장
- 메모리에서 데이터를 읽거나 쓸 때는 워드 단위로(32bit CPU → 1워드는 32bit)

### 2.1 메모리의 종류

![RAM과 ROM](/operating-system/images/RAM과%20ROM.png)

**RAM**

- RAM(Random Access Memory): 읽거나 쓸 수 있음

  - 데이터를 읽어도 저장된 위치와 상관없이 같은 속도로 데이터를 읽을 수 있음

- **휘발성 메모리**

  - **DRAM(Dynamic RAM, 동적 램)**
    - 일정시간이 지나면 데이터가 사라지므로 일정 시간마다 **다시 재생**시켜야함
    - 메인메모리에 사용
  - **SRAM(Static RAM, 정적 램)**
    - 전력이 공급되는 동안에는 데이터를 보관할 수 있어 재생할 필요가 없음
    - 속도는 빠르지만 가격이 비쌈
    - 고속 메모리에 사용(캐시 등)
  - **SDRAM(Synchronous Dynamic Random Access Memory)**
    - DRAM이 발전된 형태
    - **클록틱(펄스)이 발생할 때마다 데이터를 저장하는 동기 DRAM**

- **비휘발성 메모리**
  - **플래시 메모리(flash memory)**
    - 디지털카메라, MP3 플레이어, USB 드라이버
    - 전력이 없어도 데이터를 보관하는 저장장치
    - 각 소자는 최대 사용 횟수가 제한되어 있음 → 보통 소자 하나당 몇 천 번에서 만 번 정도 사용하면 제 기능을 잃음
  - **SSD**
    - 가격이 비쌈
    - 빠른 데이터 접근 속도, 저전력, 내구성
    - 개인용 컴퓨터, 노트북, 스마트폰 등에 이용
  - **FRAM(Ferroelectric RAM)**
  - **PRAM(Phase change RAM)**

**ROM**

- ROM(Read Only Memory): 읽기만 가능
- 전력이 끊겨도 데이터를 보관하는 것이 장점
- 데이터를 한 번 저장하면 바꿀 수 없음
- 바이오스(BIOS, Basic Input/Output System)를 롬에 저장
- **마스크롬(mask ROM)**
  - 데이터를 지우거나 쓸 수 없음
- **PROM(Progammable ROM)**
  - 전용 기계를 이용하여 데이터를 한 번만 저장
- **EPROM(Erasable Progammable ROM)**
  - 데이터를 여러 번 쓰고 지울 수 있음
  - 플래시 메모리처럼 사용할 수 있음 → 비싸서 잘 사용하지 않음

### 2.2 메모리 보호

- 일괄 작업 시스템(일괄 처리 시스템)
  - 메모리가 운영체제 영역과 사용자 영역으로 구분
  - 사용자 영역의 작업이 운영체제 영역으로 침범하지 못하도록 막아야 함
- 시분할

  - 여러 프로그램을 동시에 실행
  - 사용자 영역이 여러 개의 작업 공간으로 나뉨
  - 운영체제 영역이나 다른 프로그램 영역으로 침범하지 못하도록 막아야 함

- 운영체제도 CPU 사용하는 작업 중 하나이므로 사용자의 작업이 진행되는 동안에는 운영체제의 작업이 일시 중단됨

  - 사용자의 작업으로부터 메모리를 보호하려면 ⇒ 하드웨어의 도움 필요

- 메모리 보호

  - CPU는 현재 진행 중인 작업의 메모리 시작 주소를 **경계 레지스터**에 저장한 후 작업
  - 또한 메모리의 크기, 즉 마지막 주소까지의 차이를 **한계 레지스터**에 저장
  - 사용자의 작업이 진행되는 동안 **이 두 레지스터의 주소 범위를 벗어나는지** 하드웨어적으로 점검함으로써 **메모리를 보호**

- 만약 두 레지스터의 값이 벗어난다면
  - 메모리 오류와 관련된 인터럽트가 발생함
    - 인터럽트가 발생하면 모든 작업 중단
    - CPU는 운영체제를 깨워서 인터럽트 처리

### 2.3 부팅

- 응용프로그램: 운영체제가 메모리에 올림
- 운영체제: 부팅 시 메모리에 올리는 과정 필요

![부팅과정](/operating-system/images/부팅과정.png)

- 사용자가 컴퓨터의 전원을 켜면 롬에 저장된 바이오스가 실행됨

- 바이오스
  - CPU, 메모리, 하드디스크, 키보드, 마우스와 같은 주요 하드웨어가 제대로 작동하는지 확인
  - 이상 있으면 오류 메시지 출력
  - 이상이 없으면 **하드디스크의 마스터 부트 레코드(MBR, Master Boot Record)**에 저장된 작은 프로그램을 메모리로 가져와 실행
- 마스터 부트 레코드

  - 하드디스크의 첫 번째 섹터를 가리킴
  - **운영체제를 실행하기 위한 코드**인 **부트스트랩**이 이곳에 저장됨

- **마스터 부트 레코드에 있는 부트스트랩이 메모리에 올라오면 하드디스크에 저장된 운영체제를 메모리로 불러옴**

- 부트스트랩
  - 운영체제를 메모리로 가져와 실행하는 역할을 하는 작은 프로그램
